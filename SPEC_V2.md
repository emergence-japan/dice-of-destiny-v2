# Dice of Destiny Ver2/Ver3 仕様書

## 📌 プロジェクト概要

### 背景
- **オリジナル**: dice-of-destiny（Ver1）
- **開発中**: dice-of-destiny-v2（Ver2）
- **将来**: Ver3を見据えた設計

### リポジトリ情報
- **オリジナル**: https://github.com/emergence-japan/dice-of-destiny
- **Ver2**: https://github.com/emergence-japan/dice-of-destiny-v2
- **ローカルパス**: `C:\Users\music\my-project\dice-of-destiny-v2`

---

## 🎯 Ver2 の目的と仕様

### 基本コンセプト
- **ゲーム単体で完結する構成**
- サーベイは必要な時のみ使用（別ファイルとして独立）
- Ver3への移行を見据えたモジュール設計

### ファイル構成
```
dice-of-destiny-v2/
├── index.html           # メインゲーム（スタンドアロン）
├── pre-survey.html      # プリサーベイ（独立ファイル）
├── post-survey.html     # ポストサーベイ（独立ファイル）
├── css/
│   ├── variables.css    # CSS変数（共通）
│   ├── main.css         # メインスタイル（共通）
│   └── survey.css       # サーベイスタイル（共通）
├── js/                  # JavaScript（共通、再利用可能）
├── assets/              # 画像などのアセット
└── SPEC_V2.md          # この仕様書
```

### 主な機能要件

#### 1. ゲーム（index.html）
- サーベイなしで完結するスタンドアロン版
- ゲーム内で最低限のジオグラフィック情報を収集
- ゲーム部のテキストを一部差し替え（詳細は実装時に指定）

#### 2. プリサーベイ（pre-survey.html）
- Ver1のプリサーベイから**ジオグラフィック情報部分を除去**
- サーベイ質問のみを含む
- 必要な時のみ使用

#### 3. ポストサーベイ（post-survey.html）
- Ver1と同じ内容
- 独立ファイルとして動作
- 必要な時のみ使用

---

## 🚀 Ver3 の構想

### 追加機能

#### 1. トップページ（ランディングページ）
新規作成する統合ページ。以下の機能を提供：
- プリサーベイ、ゲーム、ポストサーベイの選択
- ジオグラフィック情報の一元管理

#### 2. ユーザーフロー
```
1. トップページにアクセス
   ↓
2. ジオグラフィック情報を入力（必須）
   - 匿名コード
   - 年齢
   - 性別
   - 人種/民族
   - 学年
   - 専攻
   - 学生/就労状況
   ↓
3. 実施内容を選択
   - プリサーベイ
   - ゲーム
   - ポストサーベイ
   （複数選択可能、またはゲームのみでもOK）
   ↓
4. 選択したコンテンツへ遷移
```

#### 3. Ver2 と Ver3 の関係
```
Ver3 = Ver2（分離されたファイル群） + トップページ + 統合機能
```
- Ver3はVer2を含む
- Ver2で基盤構築、Ver3で統合層を追加

---

## 📊 データ収集仕様

### 基本方針
- **収集する情報はVer1と同じ**
- **新規スプレッドシートを作成**
- **1つのシートに全データを集約**

### ジオグラフィック情報の扱い

#### Ver1（現在）
```
プリサーベイ内に含まれる：
├── Q1: 匿名コード
├── Q2: 年齢
├── Q3: 性別
├── Q4: 人種/民族（複数選択可）
├── Q5: 学年
├── Q6: 専攻
└── Q7: 学生/就労状況
```

#### Ver2
```
ゲーム内に含める（スタンドアロン動作のため）：
└── 上記と同じジオグラフィック情報
```

#### Ver3
```
トップページに移行：
└── 上記ジオグラフィック情報を一元管理
    ↓
プリサーベイからは削除
ゲームでは不要（トップページで取得済み）
```

### データ構造（想定）
| タイムスタンプ | 匿名コード | 年齢 | 性別 | 人種/民族 | 学年 | 専攻 | 就労状況 | ソース | プリサーベイデータ | ゲームデータ | ポストサーベイデータ |
|---|---|---|---|---|---|---|---|---|---|---|---|
| 2025-01-21 10:30 | 0509S | 25 | Female | Asian | Junior | Psychology | Student | game | - | {...} | - |
| 2025-01-21 11:00 | 0612T | 30 | Male | White | Senior | Biology | Working student | pre+game | {...} | {...} | - |

### Google Apps Script
- **Ver1**: 既存のスプレッドシート・スクリプトを使用
- **Ver2/Ver3**: 新規スプレッドシート・スクリプトを作成
- データ送信先URLは実装時に設定

---

## 🔧 技術スタック

### フロントエンド
- **HTML5**: セマンティックなマークアップ
- **CSS3**: レスポンシブデザイン
- **Vanilla JavaScript**: フレームワーク不使用

### 外部依存
- Google Fonts: Cinzel, Lora
- Google Apps Script: データ送信先

### ビルドツール
- **なし**: 静的HTMLとして動作

---

## ✅ 実装タスク（Ver2）

### Phase 1: ファイル分離
- [ ] プリサーベイを `pre-survey.html` として分離
  - ジオグラフィック情報部分を削除
  - サーベイ質問のみ残す
- [ ] ポストサーベイを `post-survey.html` として分離
- [ ] 共通CSS/JSを整理（再利用可能に）

### Phase 2: ゲーム改修
- [ ] `index.html` をゲーム単体版に改修
  - ウェルカム → Important Notes → ゲーム本編の流れ
- [ ] ジオグラフィック情報入力ページをゲーム冒頭に追加
  - Ver1のプリサーベイQ1-Q7と同じ項目
- [ ] ゲーム部のテキスト差し替え（詳細は後で指定）

### Phase 3: データ送信
- [ ] 新規Google Apps Script作成
- [ ] 新規スプレッドシート作成
- [ ] データ送信ロジックの実装/調整

### Phase 4: テスト
- [ ] 各ファイルが独立して動作することを確認
- [ ] データ送信のテスト
- [ ] クロスブラウザテスト

---

## 🎨 設計方針

### Ver3を見据えた実装
1. **モジュール化**
   - CSS/JSを共通ファイルとして分離
   - 各HTMLから参照する構造

2. **拡張性**
   - トップページ追加時にファイル構成を変えずに統合可能
   - データフロー変更に対応しやすい設計

3. **保守性**
   - コメントの充実
   - 一貫した命名規則
   - 変数名・関数名の意味を明確に

4. **再利用性**
   - ジオグラフィック情報収集フォームのHTML/CSSは使い回せる形に
   - サーベイフォームのスタイルも共通化

---

## 📝 未決定事項・TODO

### 実装時に決定すべき事項
1. **ゲーム部のテキスト差し替え**
   - どのセクションのどのテキストか
   - 新しいテキストの内容

2. **Google Apps Script URL**
   - 新規作成後にURLを設定

3. **Ver2でVer3機能を含めるか**
   - トップページをVer2に含める？
   - それともVer3で追加？
   - **→ 要相談**

### データ収集の詳細
- 同一ユーザーが複数回アクセスした場合の処理
- タイムスタンプのフォーマット
- エラーハンドリング

---

## 🗓️ 次回アクションアイテム

### 実装開始前に確認
1. Ver2にトップページを含めるか決定
2. ゲーム部のテキスト差し替え内容の確認
3. 新規スプレッドシート・Apps Scriptの作成

### 実装の優先順位
1. ファイル分離（Phase 1）
2. ゲーム改修（Phase 2）
3. データ送信（Phase 3）
4. テスト（Phase 4）

---

## 📌 重要な注意事項

### Ver1との互換性
- データ収集内容はVer1と同じ
- ジオグラフィック情報の項目は変更しない
- Ver1のユーザー体験を損なわない

### Ver3への移行
- Ver2はVer3の基盤となる
- モジュール設計により、Ver3実装時の変更を最小化
- トップページ追加のみでVer3に移行できる設計

---

## 📚 参考情報

### 既存ファイル
- `Phase0_Implementation_Guide.md`
- `Phase1_Basic_Structure_Navigation.md`
- `Phase2_Survey_Forms.md`
- `Phase3_Game_Stages.md`
- `Phase4_Data_Integration_Polish.md`

これらのドキュメントにVer1の実装詳細が記載されている可能性あり。

---

**最終更新日**: 2025-01-21
**作成者**: User & Claude Code
**バージョン**: 1.0
